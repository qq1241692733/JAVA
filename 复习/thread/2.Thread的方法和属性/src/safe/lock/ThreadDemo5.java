package safe.lock;

/**
 * Created with IntelliJ IDEA.
 * Description:
 * æ–‡æ¡£æ³¨é‡Š ä¸€èˆ¬ç”¨äº æ–¹æ³•çš„æ³¨é‡Šå’Œç±»çš„æ³¨é‡Š
 * User: hong yaO
 * Date: 2021-10-2021/10/4
 * Time: 17:13
 */

public class ThreadDemo5 {
    /**
     * è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼š
     *   1.CPU æŠ¢å æ€§æ‰§è¡Œï¼ˆä¸èƒ½è§£å†³ï¼‰
     *   2.æ¯ä¸ªçº¿ç¨‹æ“ä½œè‡ªå·±çš„å˜é‡ï¼ˆå¯èƒ½ï¼‰ä¸é€šç”¨ï¼Œä¿®æ”¹éš¾åº¦å¤§
     *   3.åœ¨å…³é”®ä»£ç ç»•è¿‡æ‰€æœ‰çš„CPUæ’é˜Ÿæ‰§è¡Œï¼ŒåŠ é”
     *      å…³é”®æ­¥éª¤ï¼š
     * 	        1.å°è¯•è·å–é” ï¼ˆå¦‚æœæˆåŠŸæ‹¿åˆ°é”ï¼Œæ’é˜Ÿç­‰å¾…ï¼‰
     * 	        2.é‡Šæ”¾é”
     *
     * Java ä¸­è§£å†³çº¿ç¨‹å®‰å…¨æ–¹æ¡ˆï¼š
     *   1.synchronized åŠ é”å’Œé‡Šæ”¾é”ï¼ˆJVM å±‚é¢çš„è§£å†³æ–¹æ¡ˆï¼Œä¼šè‡ªåŠ¨è¿›è¡ŒåŠ é”å’Œé‡Šæ”¾é”ï¼‰
     *     æ³¨æ„ï¼šåŒä¸€ç»„ä¸šåŠ¡ä¸€å®šè¦åŒä¸€æŠŠğŸ”’
     *
     *     	å®ç°åŸç†ï¼š
     * 		1. æ“ä½œç³»ç»Ÿï¼š äº’æ–¥é” mutex
     * 		2. JVMï¼š å¸®æˆ‘ä»¬å®ç°çš„ç›‘è§†å™¨é”çš„åŠ é”å’Œé‡Šæ”¾é”çš„æ“ä½œ
     * 		3. Javaï¼š
     * 				é”å¯¹è±¡ mutex
     * 				é”å­˜çš„åœ°æ–¹ï¼š å˜é‡çš„å¯¹è±¡å¤´
     * 		synchronized JDK 6 ä¹‹å‰ä½¿ç”¨é‡é‡çº§é”å®ç°ï¼Œæ€§èƒ½ä½ï¼Œæ¯”å¸¸ç”¨
     * 		JDK 6å¯¹ synchronized åšäº†ä¸€ä¸ªä¼˜åŒ–ï¼ˆï¼‰
     *          æ— é” --(ç¬¬ä¸€æ¬¡è®¿é—®) å‡çº§--> åå‘é” --è‡ªæ—‹ï¼šwhile(true) {å°è¯•è·å–é”} å‡çº§-->
     *          è½»é‡çº§é” --ä¸€æ®µæ—¶é—´è¿˜æœªè·å–åˆ°é”ï¼šåœæ­¢è‡ªæ—‹ï¼Œå¹¶æŠŠå½“å‰æ²¡æœ‰è·å–åˆ°é”çš„çº¿ç¨‹æ”¾åˆ°ç­‰å¾…é˜Ÿåˆ—é‡Œè¾¹ å‡çº§--> é‡é‡çº§é”
     *          è§†é¢‘ï¼šçº¿ç¨‹(3)ï¼Œ1:49:00 å·¦å³
     *
     *      é‡ç‚¹æŸ¥çœ‹ï¼š
     *        æŸ¥çœ‹è¯¾ä»¶ï¼šå¤šçº¿ç¨‹-åˆé˜¶
     *        åšå®¢ï¼šhttps://www.jianshu.com/p/19f861ab749e
     *        è§†é¢‘ï¼šçº¿ç¨‹(3)ï¼Œ1:20:00 å·¦å³
     *
     *   2.Lock æ‰‹åŠ¨ğŸ”’ï¼ˆç¨‹åºå‘˜éœ€è¦è‡ªå·±è¿›è¡ŒåŠ é”å’Œé‡Šæ”¾é”ï¼‰
     *      åªèƒ½ç”¨æ¥ä¿®é¥°ä»£ç å—
     */
    private static int number= 0;
    private static int maxSize= 1000000;
    public static void main(String[] args) throws InterruptedException {
        // åˆ›å»ºğŸ”’
        Object lock = new Object();
        Thread t1 = new Thread(new Runnable() {
            @Override
            public void run() {
                for (int i = 0; i < maxSize; i++) {
                    synchronized (lock) {
                        number++;
                    }
                }
            }
        });
        t1.start();
        Thread t2 = new Thread(new Runnable() {
            @Override
            public void run() {
                for (int i = 0; i < maxSize; i++) {
                    synchronized (lock) {
                        number--;
                    }
                }
            }
        });
        t2.start();

        t1.join();
        t2.join();

        System.out.println(number);
    }
}
